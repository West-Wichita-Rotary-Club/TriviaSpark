import{a as U,u as F,r as P,j as e,f as q,X as A}from"./index-CBK1NrN0.js";import{u as L}from"./useQuery-ChBtYIvF.js";import{u as M}from"./useMutation-D36UegRK.js";import{u as k,L as r,I as c}from"./label-DiqovXeP.js";import{C as p,a as f,b as j,c as N}from"./card-B41-nYR3.js";import{B as o}from"./button-D3Wh1zJr.js";import{A as I,a as T,U as B}from"./avatar-ClrOyyae.js";import{S as g}from"./separator-CuioNaKi.js";import{B as D}from"./brain-BxYzVyfP.js";import{C as z}from"./calendar-DzyctjZO.js";import{a as H,S as J}from"./square-pen-BXedAM7Z.js";import{M as K}from"./mail-D4y1QRIY.js";function se(){const{toast:x}=U(),[,v]=F(),[u,i]=P.useState(!1),{data:s,isLoading:l,error:y}=L({queryKey:["/api/auth/me"],retry:!1});if(y||!l&&!s)return v("/"),null;if(l)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{className:"text-champagne-400 h-8 w-8 animate-pulse"})}),e.jsx("p",{className:"text-wine-700",children:"Loading..."})]})});const{register:n,handleSubmit:b,reset:h,formState:{errors:t}}=k(),d=M({mutationFn:async a=>{const m=await fetch("/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});if(!m.ok){const E=await m.json();throw new Error(E.error||"Update failed")}return m.json()},onSuccess:()=>{x({title:"Profile Updated",description:"Your profile has been successfully updated."}),i(!1)},onError:a=>{x({title:"Update Failed",description:a.message,variant:"destructive"})}}),w=a=>{d.mutate(a)},S=()=>{s?.user&&h({fullName:s.user.fullName,email:s.user.email,username:s.user.username}),i(!0)},C=()=>{i(!1),h()};return l?e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900","data-testid":"text-profile-title",children:"User Profile"}),e.jsx("p",{className:"text-gray-600","data-testid":"text-profile-subtitle",children:"Manage your account information and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs(p,{className:"trivia-card","data-testid":"card-profile-overview",children:[e.jsxs(f,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(I,{className:"w-24 h-24","data-testid":"avatar-profile",children:e.jsx(T,{className:"wine-gradient text-white text-2xl font-bold",children:s?.user?.fullName?.split(" ").map(a=>a[0]).join("")||"U"})})}),e.jsx(j,{className:"text-xl","data-testid":"text-user-name",children:s?.user?.fullName||"User"}),e.jsxs("p",{className:"text-gray-600","data-testid":"text-user-username",children:["@",s?.user?.username]})]}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{"data-testid":"text-member-since",children:["Member since ",s?.user?.createdAt?q(s.user.createdAt):"Unknown"]})]})})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(p,{className:"trivia-card","data-testid":"card-profile-info",children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"flex items-center","data-testid":"text-profile-info-title",children:[e.jsx(B,{className:"mr-2 h-5 w-5"}),"Profile Information"]}),!u&&e.jsxs(o,{onClick:S,variant:"outline",size:"sm","data-testid":"button-edit-profile",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Edit"]})]})}),e.jsx(N,{children:u?e.jsxs("form",{onSubmit:b(w),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"fullName","data-testid":"label-full-name",children:"Full Name"}),e.jsx(c,{id:"fullName",...n("fullName",{required:"Full name is required"}),className:"mt-1","data-testid":"input-full-name"}),t.fullName&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-full-name",children:t.fullName.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"email","data-testid":"label-email",children:"Email Address"}),e.jsx(c,{id:"email",type:"email",...n("email",{required:"Email is required",pattern:{value:/\S+@\S+\.\S+/,message:"Enter a valid email address"}}),className:"mt-1","data-testid":"input-email"}),t.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-email",children:t.email.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"username","data-testid":"label-username",children:"Username"}),e.jsx(c,{id:"username",...n("username",{required:"Username is required"}),className:"mt-1","data-testid":"input-username"}),t.username&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-username",children:t.username.message})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(o,{type:"submit",disabled:d.isPending,className:"trivia-button-primary","data-testid":"button-save-profile",children:d.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Save Changes"]})}),e.jsxs(o,{type:"button",onClick:C,variant:"outline","data-testid":"button-cancel-edit",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-gray-600",children:"Full Name"}),e.jsx("p",{className:"font-medium mt-1","data-testid":"text-display-full-name",children:s?.user?.fullName||"Not set"})]}),e.jsx(g,{}),e.jsxs("div",{children:[e.jsx(r,{className:"text-gray-600",children:"Email Address"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(K,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("p",{className:"font-medium","data-testid":"text-display-email",children:s?.user?.email||"Not set"})]})]}),e.jsx(g,{}),e.jsxs("div",{children:[e.jsx(r,{className:"text-gray-600",children:"Username"}),e.jsxs("p",{className:"font-medium mt-1","data-testid":"text-display-username",children:["@",s?.user?.username||"Not set"]})]})]})})]})})]})]})}export{se as default};
