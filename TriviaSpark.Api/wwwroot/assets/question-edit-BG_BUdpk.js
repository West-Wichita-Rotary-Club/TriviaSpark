import{c as q,u as ne,a as le,b as ce,r as c,j as e,X as oe}from"./index-l74yJ-DA.js";import{u as _}from"./useQuery-CM9bS8sK.js";import{u as Q}from"./useMutation-D6DsXwTc.js";import{u as de,S as A,a as P,b as $,c as O,d as p}from"./select-D6rZcnQa.js";import{C as w,a as b,b as k,c as S}from"./card-BV_NaFVl.js";import{B as x}from"./button-BSjZ02wq.js";import{L as r,I as h}from"./label-nllsOUkb.js";import{T as V}from"./textarea-ACBGeDoh.js";import{A as z}from"./arrow-left-PAZ6DZ1S.js";import{S as me}from"./save-ChqbcB40.js";import"./index-BdQq_4o_.js";import"./index-BE2CbBfx.js";import"./Combination-CSEjHZTw.js";import"./chevron-up-CZ-NuTr0.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],xe=q("download",ue);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ge=q("eye",he);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],je=q("search",pe),Fe=({eventId:o,questionId:g})=>{const[,f]=ne(),{toast:j}=le(),M=ce(),{register:d,handleSubmit:B,setValue:n,watch:I,formState:{errors:l,isDirty:R}}=de({defaultValues:{questionType:"game"}}),[v,C]=c.useState(["","","",""]),[N,D]=c.useState(""),[T,H]=c.useState([]),[K,E]=c.useState(!1),[a,G]=c.useState(null),[J,U]=c.useState(!1),[X,W]=c.useState({unsplashImageId:"",sizeVariant:"regular",usageContext:"question_background",searchContext:""}),{data:Y,isLoading:Z}=_({queryKey:["/api/events",o,"questions"],queryFn:async()=>{const s=await fetch(`/api/events/${o}/questions`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch questions");return s.json()},enabled:!!o}),t=Y?.find(s=>s.id===g),{data:m,refetch:ee}=_({queryKey:["/api/questions",g,"eventimage"],queryFn:async()=>{const s=await fetch(`/api/questions/${g}/eventimage`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch event image");return s.json()},enabled:!!g});c.useEffect(()=>{t&&(n("question",t.question),n("correctAnswer",t.correctAnswer),n("points",t.points),n("timeLimit",t.timeLimit),n("difficulty",t.difficulty),n("category",t.category),n("explanation",t.explanation||""),n("orderIndex",t.orderIndex),n("backgroundImageUrl",t.backgroundImageUrl||""),n("questionType",t.questionType||"game"),C(t.options||["","","",""]))},[t,n]),c.useEffect(()=>{if(m?.eventImage){const s=m.eventImage;W({unsplashImageId:s.unsplashImageId||"",sizeVariant:s.sizeVariant||"regular",usageContext:s.usageContext||"question_background",searchContext:s.searchContext||""})}},[m]);const y=Q({mutationFn:async s=>{const i={Question:s.question,Type:t?.type||"multiple_choice",Options:v.filter(re=>re.trim()!==""),CorrectAnswer:s.correctAnswer,Difficulty:s.difficulty,Category:s.category,Explanation:s.explanation,TimeLimit:s.timeLimit,OrderIndex:s.orderIndex,AiGenerated:t?.aiGenerated,BackgroundImageUrl:s.backgroundImageUrl||null,SelectedImage:a?{Id:a.id,Author:a.user.name,AuthorUrl:a.user.links.html,PhotoUrl:a.urls.regular,DownloadUrl:a.links.download_location||""}:null,QuestionType:s.questionType||"game"},u=await fetch(`/api/questions/${g}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include"});if(!u.ok)throw new Error("Failed to update question");return u.json()},onSuccess:()=>{M.invalidateQueries({queryKey:["/api/events",o,"questions"]}),j({title:"Success",description:"Question updated successfully"}),f(`/events/${o}/manage/trivia`)},onError:s=>{j({title:"Error",description:s.message||"Failed to update question",variant:"destructive"})}}),se=Q({mutationFn:async()=>{if(!a)return;const s={NewUnsplashImageId:a.id,SizeVariant:X.sizeVariant,SelectedByUserId:null},i=await fetch(`/api/EventImages/question/${g}/replace`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!i.ok)throw new Error("Failed to save event image");return i.json()},onSuccess:()=>{ee(),j({title:"Success",description:"Event image saved successfully"})},onError:s=>{j({title:"Error",description:s.message||"Failed to save event image",variant:"destructive"})}}),F=async()=>{if(N.trim()){E(!0);try{const s=await fetch(`/api/unsplash/search?query=${encodeURIComponent(N)}&perPage=12`);if(!s.ok)throw new Error("Search failed");const i=await s.json();H(i.results||[])}catch(s){j({title:"Search Error",description:s.message,variant:"destructive"})}finally{E(!1)}}},te=async s=>{if(s.links.download_location)try{await fetch("/api/unsplash/track-download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({downloadUrl:s.links.download_location}),credentials:"include"})}catch(i){console.warn("Failed to track download:",i)}},ae=async s=>{G(s),n("backgroundImageUrl",s.urls.regular),await te(s)},ie=(s,i)=>{const u=[...v];u[s]=i,C(u)},L=B(async s=>{a&&await se.mutateAsync(),y.mutate(s)});return Z?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-b-2 border-wine-600 rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading question..."})]})}):t?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(x,{variant:"ghost",onClick:()=>f(`/events/${o}/manage/trivia`),className:"text-wine-600 hover:text-wine-700 hover:bg-wine-50",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Back to Trivia Management"]}),e.jsx("h1",{className:"text-3xl font-bold text-wine-900",children:"Edit Question"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>f(`/events/${o}/manage/trivia`),disabled:y.isPending,children:"Cancel"}),e.jsxs(x,{onClick:L,disabled:y.isPending||!R,className:"bg-wine-600 hover:bg-wine-700",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),y.isPending?"Saving...":"Save Question"]})]})]}),e.jsxs("form",{onSubmit:L,className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(k,{children:"Question Details"})}),e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"question",className:"text-sm font-medium",children:"Question Text *"}),e.jsx(V,{id:"question",rows:4,...d("question",{required:"Question text is required"}),className:"mt-1",placeholder:"Enter your trivia question here..."}),l.question&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.question.message})]}),t.type==="multiple_choice"&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium",children:"Answer Options"}),e.jsx("div",{className:"mt-2 space-y-3",children:v.map((s,i)=>e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("span",{className:"w-8 h-8 rounded bg-wine-100 flex items-center justify-center text-sm font-semibold text-wine-700",children:String.fromCharCode(65+i)}),e.jsx(h,{value:s,onChange:u=>ie(i,u.target.value),placeholder:`Option ${String.fromCharCode(65+i)}`,className:"flex-1"})]},i))})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"correctAnswer",className:"text-sm font-medium",children:"Correct Answer *"}),e.jsx(h,{id:"correctAnswer",...d("correctAnswer",{required:"Correct answer is required"}),className:"mt-1",placeholder:"Enter the correct answer"}),l.correctAnswer&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.correctAnswer.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"points",className:"text-sm font-medium",children:"Points"}),e.jsx(h,{id:"points",type:"number",min:1,max:500,...d("points",{required:"Points are required",min:{value:1,message:"Points must be at least 1"},max:{value:500,message:"Points cannot exceed 500"}}),className:"mt-1"}),l.points&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.points.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"timeLimit",className:"text-sm font-medium",children:"Time Limit (seconds)"}),e.jsx(h,{id:"timeLimit",type:"number",min:5,max:300,...d("timeLimit",{required:"Time limit is required",min:{value:5,message:"Time limit must be at least 5 seconds"},max:{value:300,message:"Time limit cannot exceed 300 seconds"}}),className:"mt-1"}),l.timeLimit&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.timeLimit.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"orderIndex",className:"text-sm font-medium",children:"Order #"}),e.jsx(h,{id:"orderIndex",type:"number",min:1,...d("orderIndex",{required:"Order index is required",min:{value:1,message:"Order must be at least 1"}}),className:"mt-1"}),l.orderIndex&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.orderIndex.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"difficulty",className:"text-sm font-medium",children:"Difficulty"}),e.jsxs(A,{value:I("difficulty"),onValueChange:s=>n("difficulty",s,{shouldDirty:!0}),children:[e.jsx(P,{className:"mt-1",children:e.jsx($,{placeholder:"Select difficulty"})}),e.jsxs(O,{children:[e.jsx(p,{value:"easy",children:"Easy"}),e.jsx(p,{value:"medium",children:"Medium"}),e.jsx(p,{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"questionType",className:"text-sm font-medium",children:"Question Type"}),e.jsxs(A,{value:I("questionType")||"game",onValueChange:s=>n("questionType",s,{shouldDirty:!0}),children:[e.jsx(P,{className:"mt-1",children:e.jsx($,{placeholder:"Select question type"})}),e.jsxs(O,{children:[e.jsx(p,{value:"game",children:"Game"}),e.jsx(p,{value:"training",children:"Training"}),e.jsx(p,{value:"tie-breaker",children:"Tie-breaker"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"category",className:"text-sm font-medium",children:"Category"}),e.jsx(h,{id:"category",...d("category"),className:"mt-1",placeholder:"e.g., History, Science, Sports"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"explanation",className:"text-sm font-medium",children:"Explanation (optional)"}),e.jsx(V,{id:"explanation",rows:3,...d("explanation"),className:"mt-1",placeholder:"Provide additional context or explanation for the answer..."})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(k,{className:"text-lg",children:"Question Image"})}),e.jsxs(S,{className:"space-y-4",children:[t.backgroundImageUrl?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.backgroundImageUrl,alt:"Question background",className:"w-full h-40 object-cover rounded-lg"}),e.jsx(x,{type:"button",variant:"secondary",size:"sm",className:"absolute top-2 right-2",onClick:()=>U(!0),children:e.jsx(ge,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"w-full h-40 bg-gray-100 rounded-lg flex items-center justify-center text-gray-500",children:"No image selected"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(r,{className:"text-sm font-medium",children:"Search Unsplash"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:N,onChange:s=>D(s.target.value),placeholder:"Search for images...",onKeyDown:s=>s.key==="Enter"&&F()}),e.jsx(x,{type:"button",onClick:F,disabled:K,size:"sm",children:e.jsx(je,{className:"h-4 w-4"})})]})]}),T.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(r,{className:"text-sm font-medium",children:"Search Results"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-96 overflow-y-auto",children:T.map(s=>e.jsxs("div",{className:`relative cursor-pointer border-2 rounded-lg overflow-hidden transition-all ${a?.id===s.id?"border-wine-500 ring-2 ring-wine-200":"border-gray-200 hover:border-gray-300"}`,onClick:()=>ae(s),children:[e.jsx("img",{src:s.urls.thumb,alt:s.alt_description||s.description||"Unsplash image",className:"w-full h-24 object-cover"}),a?.id===s.id&&e.jsx("div",{className:"absolute inset-0 bg-wine-500 bg-opacity-20 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-full p-1",children:e.jsx(xe,{className:"h-4 w-4 text-wine-600"})})})]},s.id))})]}),a&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["Photo by"," ",e.jsx("a",{href:`${a.user.links.html}?utm_source=TriviaSpark&utm_medium=referral`,target:"_blank",rel:"noreferrer",className:"underline text-wine-600 hover:text-wine-700",children:a.user.name})," ","on"," ",e.jsx("a",{href:`${a.links.html}?utm_source=TriviaSpark&utm_medium=referral`,target:"_blank",rel:"noreferrer",className:"underline text-wine-600 hover:text-wine-700",children:"Unsplash"})]})})]})]}),m&&e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(k,{className:"text-lg",children:"Event Image Record"})}),e.jsx(S,{className:"space-y-4",children:e.jsxs("div",{className:"text-xs space-y-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-xs font-medium",children:"Image ID:"}),e.jsx("p",{className:"text-gray-600",children:m.eventImage?.unsplashImageId||"None"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs font-medium",children:"Size Variant:"}),e.jsx("p",{className:"text-gray-600",children:m.eventImage?.sizeVariant||"regular"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs font-medium",children:"Usage Context:"}),e.jsx("p",{className:"text-gray-600",children:m.eventImage?.usageContext||"question_background"})]})]})})]})]})]}),J&&t.backgroundImageUrl&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("img",{src:t.backgroundImageUrl,alt:"Question background preview",className:"max-w-full max-h-full object-contain"}),e.jsx(x,{variant:"secondary",size:"sm",className:"absolute top-4 right-4",onClick:()=>U(!1),children:e.jsx(oe,{className:"h-4 w-4"})})]})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Question not found"}),e.jsxs(x,{onClick:()=>f(`/events/${o}/manage/trivia`),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Back to Trivia Management"]})]})})};export{Fe as default};
