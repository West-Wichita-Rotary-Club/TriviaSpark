import{a as N,u as v,r as y,j as e,L as C}from"./index-BFcyDbgc.js";import{u as S}from"./useMutation-BeJXQZF0.js";import{u as P}from"./index.esm-Ck0_1ULb.js";import{C as E,a as F,b as L,c as q}from"./card-DNCpzTHJ.js";import{B as h}from"./button-DZ0Fbg5c.js";import{L as o,I as i}from"./label-auqsHuen.js";import{B as R}from"./brain-Cs2N-qUE.js";import{U as T}from"./user-plus-DmZZ47YV.js";function M(){const{toast:l}=N(),[,c]=v(),[p,u]=y.useState(!1),{register:a,handleSubmit:w,watch:f,formState:{errors:s}}=P(),g=f("password"),j=S({mutationFn:async r=>{u(!0);try{const t=await fetch("/api/v2/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r.name,email:r.email,password:r.password}),credentials:"include"}),x=t.headers.get("content-type");if(!x||!x.includes("application/json"))throw new Error("Server returned non-JSON response");const n=await t.text();if(!n)throw new Error("Empty response from server");let d;try{d=JSON.parse(n)}catch(m){throw console.error("JSON parse error:",m),console.error("Response text:",n),new Error("Invalid JSON response from server")}if(!t.ok){const m=d?.error||"Registration failed";throw new Error(m)}return d}catch(t){throw console.error("Registration request error:",t),t}},onSuccess:r=>{l({title:"Registration Successful!",description:`Welcome ${r.user.fullName}! You have been automatically logged in.`}),c("/dashboard")},onError:r=>{l({title:"Registration Failed",description:r.message,variant:"destructive"})},onSettled:()=>{u(!1)}}),b=r=>{j.mutate(r)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs(E,{className:"trivia-card shadow-2xl","data-testid":"card-register",children:[e.jsxs(F,{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-2xl flex items-center justify-center mx-auto",children:e.jsx(R,{className:"text-champagne-400 h-8 w-8"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl wine-text mb-2","data-testid":"text-register-title",children:"Create Your Account"}),e.jsx("p",{className:"text-gray-600","data-testid":"text-register-subtitle",children:"Join TriviaSpark to manage trivia events"})]})]}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:w(b),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"name","data-testid":"label-name",children:"Full Name"}),e.jsx(i,{id:"name",...a("name",{required:"Full name is required"}),placeholder:"Enter your full name",className:`mt-1 ${s.name?"border-red-500":"focus:ring-2 focus:ring-wine-500 focus:border-transparent"}`,"data-testid":"input-name",autoComplete:"name"}),s.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-name",children:s.name.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"email","data-testid":"label-email",children:"Email Address"}),e.jsx(i,{id:"email",type:"email",...a("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Please enter a valid email address"}}),placeholder:"Enter your email address",className:`mt-1 ${s.email?"border-red-500":"focus:ring-2 focus:ring-wine-500 focus:border-transparent"}`,"data-testid":"input-email",autoComplete:"email"}),s.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-email",children:s.email.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"password","data-testid":"label-password",children:"Password"}),e.jsx(i,{id:"password",type:"password",...a("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters long"}}),placeholder:"Enter your password",className:`mt-1 ${s.password?"border-red-500":"focus:ring-2 focus:ring-wine-500 focus:border-transparent"}`,"data-testid":"input-password",autoComplete:"new-password"}),s.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-password",children:s.password.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"confirmPassword","data-testid":"label-confirm-password",children:"Confirm Password"}),e.jsx(i,{id:"confirmPassword",type:"password",...a("confirmPassword",{required:"Please confirm your password",validate:r=>r===g||"Passwords do not match"}),placeholder:"Confirm your password",className:`mt-1 ${s.confirmPassword?"border-red-500":"focus:ring-2 focus:ring-wine-500 focus:border-transparent"}`,"data-testid":"input-confirm-password",autoComplete:"new-password"}),s.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-confirm-password",children:s.confirmPassword.message})]}),e.jsx(h,{type:"submit",disabled:p,className:"w-full trivia-button-primary mt-6","data-testid":"button-register",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Creating Account..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Create Account"]})})]}),e.jsx("div",{className:"text-center mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(C,{href:"/login",className:"text-wine-600 hover:text-wine-700 font-medium",children:"Sign In"})]})})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx(h,{variant:"ghost",onClick:()=>c("/"),className:"text-wine-700 hover:text-wine-800","data-testid":"button-back-home",children:"‚Üê Back to Home"})})]})})}export{M as default};
