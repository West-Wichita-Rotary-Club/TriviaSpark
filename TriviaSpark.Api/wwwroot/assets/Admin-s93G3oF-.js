import{c as R,a as q,b as L,r as w,j as e,f as T}from"./index-WO0F2_b8.js";import{u as k}from"./useQuery-Dr8bsvQp.js";import{u as v}from"./useMutation-COS27o_t.js";import{C as d,a as c,b as m,c as o}from"./card-CGeQGv1B.js";import{B as h}from"./button-sAQsxA-L.js";import{L as x,I as u}from"./label-D6uO1hs_.js";import{B as D}from"./badge-BBdgCBB3.js";import{S as N}from"./shield-Bn5XAGdi.js";import{U as b}from"./user-plus-DXyCWT1T.js";import{U as f}from"./users-BidQzC7b.js";import{K as M}from"./key-CsU0t9nm.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],C=R("crown",K);function G(){const{toast:n}=q(),y=L(),[U,p]=w.useState(!1),[a,i]=w.useState({username:"",email:"",fullName:"",password:"",roleName:"User"}),{data:t,isLoading:A,error:S}=k({queryKey:["/api/admin/users"],retry:!1}),j=v({mutationFn:async s=>{const r=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!r.ok){const l=await r.json();throw new Error(l.error||"Failed to create user")}return r.json()},onSuccess:()=>{n({title:"User Created",description:"New user has been successfully created."}),y.invalidateQueries({queryKey:["/api/admin/users"]}),p(!1),i({username:"",email:"",fullName:"",password:"",roleName:"User"})},onError:s=>{n({title:"Create User Failed",description:s.message,variant:"destructive"})}}),g=v({mutationFn:async({userId:s,roleName:r})=>{const l=await fetch(`/api/admin/users/${s}/change-role`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roleName:r}),credentials:"include"});if(!l.ok){const P=await l.json();throw new Error(P.error||"Failed to change user role")}return l.json()},onSuccess:()=>{n({title:"Role Updated",description:"User role has been successfully updated."}),y.invalidateQueries({queryKey:["/api/admin/users"]})},onError:s=>{n({title:"Role Update Failed",description:s.message,variant:"destructive"})}}),E=s=>{if(s.preventDefault(),!a.username||!a.email||!a.fullName||!a.password){n({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}j.mutate(a)},F=(s,r)=>{const l=r==="Admin"?"User":"Admin";g.mutate({userId:s,roleName:l})};return S?e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"mx-auto h-16 w-16 text-red-400 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You need admin privileges to access this page."})]})}):A?e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(N,{className:"text-champagne-400 h-8 w-8 animate-pulse"})}),e.jsx("p",{className:"text-wine-700",children:"Loading admin panel..."})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-8 w-8 text-wine-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900","data-testid":"text-admin-title",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-600","data-testid":"text-admin-subtitle",children:"Manage users and system settings"})]})]}),e.jsxs(h,{onClick:()=>p(!0),className:"trivia-button-primary","data-testid":"button-create-user",children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Create User"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(d,{className:"trivia-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(f,{className:"h-4 w-4 text-wine-600"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:t?.length||0})})]}),e.jsxs(d,{className:"trivia-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Admin Users"}),e.jsx(N,{className:"h-4 w-4 text-wine-600"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:t?.filter(s=>s.roleName==="Admin").length||0})})]}),e.jsxs(d,{className:"trivia-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Regular Users"}),e.jsx(f,{className:"h-4 w-4 text-wine-600"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:t?.filter(s=>s.roleName==="User").length||0})})]})]}),U&&e.jsxs(d,{className:"trivia-card mb-8","data-testid":"card-create-user",children:[e.jsx(c,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(b,{className:"mr-2 h-5 w-5"}),"Create New User"]})}),e.jsx(o,{children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"username",children:"Username"}),e.jsx(u,{id:"username",value:a.username,onChange:s=>i({...a,username:s.target.value}),placeholder:"Enter username",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(u,{id:"email",type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"Enter email",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"fullName",children:"Full Name"}),e.jsx(u,{id:"fullName",value:a.fullName,onChange:s=>i({...a,fullName:s.target.value}),placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"password",children:"Password"}),e.jsx(u,{id:"password",type:"password",value:a.password,onChange:s=>i({...a,password:s.target.value}),placeholder:"Enter password",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",title:"User Role",value:a.roleName,onChange:s=>i({...a,roleName:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-wine-500",children:[e.jsx("option",{value:"User",children:"User"}),e.jsx("option",{value:"Admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(h,{type:"submit",disabled:j.isPending,className:"trivia-button-primary",children:j.isPending?"Creating...":"Create User"}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"})]})]})})]}),e.jsxs(d,{className:"trivia-card","data-testid":"card-users-table",children:[e.jsx(c,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(f,{className:"mr-2 h-5 w-5"}),"All Users (",t?.length||0,")"]})}),e.jsx(o,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Role"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Created"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-900",children:"Actions"})]})}),e.jsxs("tbody",{children:[t?.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.fullName}),e.jsxs("div",{className:"text-sm text-gray-500",children:["@",s.username]})]})}),e.jsx("td",{className:"py-3 px-4 text-gray-700",children:s.email}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(D,{variant:s.roleName==="Admin"?"destructive":"secondary",className:s.roleName==="Admin"?"bg-wine-100 text-wine-800":"",children:[s.roleName==="Admin"&&e.jsx(C,{className:"w-3 h-3 mr-1"}),s.roleName]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:T(s.createdAt)}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>F(s.id,s.roleName),disabled:g.isPending,className:"text-xs",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),s.roleName==="Admin"?"Demote to User":"Promote to Admin"]})})]},s.id)),(!t||t.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-8 text-center text-gray-500",children:"No users found."})})]})]})})})]})]})}export{G as default};
