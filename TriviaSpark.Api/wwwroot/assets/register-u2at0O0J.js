import{a as v,u as b,r as N,j as e,L as C}from"./index-DjEo9KFb.js";import{u as S}from"./useMutation-5EqEgvnM.js";import{u as P}from"./index.esm-D_9uFgu_.js";import{C as E,a as F,b as L,c as q}from"./card-Dxzy7Xzy.js";import{B as h}from"./button-D_qTUNso.js";import{L as i,I as o}from"./label-17JUgi-o.js";import{B as R}from"./brain-5CUiumCC.js";import{U as T}from"./user-plus-DtevloK1.js";function M(){const{toast:c}=v(),[,l]=b(),[u,p]=N.useState(!1),{register:a,handleSubmit:f,watch:w,formState:{errors:r}}=P(),g=w("password"),j=S({mutationFn:async s=>{p(!0);try{const t=await fetch("/api/v2/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.name,email:s.email,password:s.password}),credentials:"include"}),x=t.headers.get("content-type");if(!x||!x.includes("application/json"))throw new Error("Server returned non-JSON response");const n=await t.text();if(!n)throw new Error("Empty response from server");let d;try{d=JSON.parse(n)}catch(m){throw console.error("JSON parse error:",m),console.error("Response text:",n),new Error("Invalid JSON response from server")}if(!t.ok){const m=d?.error||"Registration failed";throw new Error(m)}return d}catch(t){throw console.error("Registration request error:",t),t}},onSuccess:s=>{c({title:"Registration Successful!",description:`Welcome ${s.user.fullName}! You have been automatically logged in.`}),l("/dashboard")},onError:s=>{c({title:"Registration Failed",description:s.message,variant:"destructive"})},onSettled:()=>{p(!1)}}),y=s=>{j.mutate(s)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 to-secondary/10 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs(E,{className:"trivia-card shadow-2xl","data-testid":"card-register",children:[e.jsxs(F,{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-2xl flex items-center justify-center mx-auto",children:e.jsx(R,{className:"text-champagne-400 h-8 w-8"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl text-primary mb-2","data-testid":"text-register-title",children:"Create Your Account"}),e.jsx("p",{className:"text-muted-foreground","data-testid":"text-register-subtitle",children:"Join TriviaSpark to manage trivia events"})]})]}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:f(y),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"name","data-testid":"label-name",children:"Full Name"}),e.jsx(o,{id:"name",...a("name",{required:"Full name is required"}),placeholder:"Enter your full name",className:`mt-1 ${r.name?"border-destructive":"focus:ring-2 focus:ring-primary/20 focus:border-primary"}`,"data-testid":"input-name",autoComplete:"name"}),r.name&&e.jsx("p",{className:"text-sm text-destructive mt-1","data-testid":"error-name",children:r.name.message})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email","data-testid":"label-email",children:"Email Address"}),e.jsx(o,{id:"email",type:"email",...a("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Please enter a valid email address"}}),placeholder:"Enter your email address",className:`mt-1 ${r.email?"border-destructive":"focus:ring-2 focus:ring-primary/20 focus:border-primary"}`,"data-testid":"input-email",autoComplete:"email"}),r.email&&e.jsx("p",{className:"text-sm text-destructive mt-1","data-testid":"error-email",children:r.email.message})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password","data-testid":"label-password",children:"Password"}),e.jsx(o,{id:"password",type:"password",...a("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters long"}}),placeholder:"Enter your password",className:`mt-1 ${r.password?"border-destructive":"focus:ring-2 focus:ring-primary/20 focus:border-primary"}`,"data-testid":"input-password",autoComplete:"new-password"}),r.password&&e.jsx("p",{className:"text-sm text-destructive mt-1","data-testid":"error-password",children:r.password.message})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"confirmPassword","data-testid":"label-confirm-password",children:"Confirm Password"}),e.jsx(o,{id:"confirmPassword",type:"password",...a("confirmPassword",{required:"Please confirm your password",validate:s=>s===g||"Passwords do not match"}),placeholder:"Confirm your password",className:`mt-1 ${r.confirmPassword?"border-destructive":"focus:ring-2 focus:ring-primary/20 focus:border-primary"}`,"data-testid":"input-confirm-password",autoComplete:"new-password"}),r.confirmPassword&&e.jsx("p",{className:"text-sm text-destructive mt-1","data-testid":"error-confirm-password",children:r.confirmPassword.message})]}),e.jsx(h,{type:"submit",disabled:u,className:"w-full trivia-button-primary mt-6","data-testid":"button-register",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Creating Account..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Create Account"]})})]}),e.jsx("div",{className:"text-center mt-6 pt-6 border-t",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Already have an account?"," ",e.jsx(C,{href:"/login",className:"text-primary hover:text-primary/80 font-medium",children:"Sign In"})]})})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx(h,{variant:"ghost",onClick:()=>l("/"),className:"text-primary hover:text-primary/80","data-testid":"button-back-home",children:"‚Üê Back to Home"})})]})})}export{M as default};
