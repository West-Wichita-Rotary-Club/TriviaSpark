import{c as A,o as _,u as B,b as $,a as D,r as m,j as e}from"./index-CORj5ckH.js";import{u as P}from"./useQuery-BTSkUB1-.js";import{u as I}from"./useMutation-DysSdz3e.js";import{B as u}from"./button-UW33nt9n.js";import{C as F,a as O,b as R,c as M}from"./card-RSEwqje_.js";import{B as p}from"./badge-srDLVzK4.js";import{L as o,I as d}from"./label-DyYzwcc5.js";import{T as E}from"./textarea-DcgS4rAM.js";import{S as z,a as K,b as H,c as J,d as k}from"./select-BqWgexoz.js";import{A as V}from"./arrow-left-IQGGiIuG.js";import{B as S}from"./brain-Dw7o39P5.js";import{a as G,S as W}from"./square-pen-CdlY8YoD.js";import{T as X}from"./trash-2-e-O87ZLB.js";import"./index-buBrq22D.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Z=A("search",Y),q=({question:n,onClose:b,onSave:w,saving:g})=>{const[t,r]=m.useState({question:n.question,correctAnswer:n.correctAnswer,options:[...n.options||[]],difficulty:n.difficulty||"medium",category:n.category||"",points:n.points||100,timeLimit:n.timeLimit||30,orderIndex:n.orderIndex||1,explanation:n.explanation||"",backgroundImageUrl:n.backgroundImageUrl||""}),[x,j]=m.useState(""),[h,C]=m.useState([]),[f,y]=m.useState(!1),[a,l]=m.useState(null),[i,v]=m.useState(null),L=async()=>{if(x.trim()){y(!0),l(null);try{const s=await fetch(`/api/unsplash/search?query=${encodeURIComponent(x)}&perPage=20`);if(!s.ok)throw new Error("Search failed");const c=await s.json();C(c.results||[])}catch(s){l(s.message)}finally{y(!1)}}},U=async s=>{s.links.download_location&&fetch("/api/unsplash/track-download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({downloadUrl:s.links.download_location})}).catch(()=>{})},Q=()=>{const s={...n,question:t.question,correctAnswer:t.correctAnswer,options:t.options,difficulty:t.difficulty,category:t.category,points:t.points,timeLimit:t.timeLimit,orderIndex:t.orderIndex,explanation:t.explanation,backgroundImageUrl:t.backgroundImageUrl||null};i&&U(i),w(s)},T=(s,c)=>{const N=[...t.options];N[s]=c,r({...t,options:N})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6"})," Edit Question"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:b,variant:"outline",children:"Back"}),e.jsxs(u,{onClick:Q,disabled:g,children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," ",g?"Saving...":"Save"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Question"}),e.jsx(E,{value:t.question,rows:4,onChange:s=>r({...t,question:s.target.value})})]}),n.type==="multiple_choice"&&e.jsxs("div",{children:[e.jsx(o,{children:"Options"}),e.jsx("div",{className:"mt-2 space-y-2",children:t.options.map((s,c)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"w-8 h-10 rounded bg-gray-100 flex items-center justify-center text-sm font-semibold",children:String.fromCharCode(65+c)}),e.jsx(d,{value:s,onChange:N=>T(c,N.target.value)})]},c))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Correct Answer"}),e.jsx(d,{value:t.correctAnswer,onChange:s=>r({...t,correctAnswer:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Points"}),e.jsx(d,{type:"number",value:t.points,onChange:s=>r({...t,points:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Time Limit (s)"}),e.jsx(d,{type:"number",value:t.timeLimit,onChange:s=>r({...t,timeLimit:parseInt(s.target.value)||30})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Difficulty"}),e.jsxs(z,{value:t.difficulty,onValueChange:s=>r({...t,difficulty:s}),children:[e.jsx(K,{children:e.jsx(H,{})}),e.jsxs(J,{children:[e.jsx(k,{value:"easy",children:"Easy"}),e.jsx(k,{value:"medium",children:"Medium"}),e.jsx(k,{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Category"}),e.jsx(d,{value:t.category,onChange:s=>r({...t,category:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Order #"}),e.jsx(d,{type:"number",value:t.orderIndex,onChange:s=>r({...t,orderIndex:parseInt(s.target.value)||1})})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Explanation"}),e.jsx(E,{rows:3,value:t.explanation,onChange:s=>r({...t,explanation:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Background Image"}),t.backgroundImageUrl?e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("img",{src:t.backgroundImageUrl,alt:"Selected background",className:"w-full h-48 object-cover rounded border"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>{r({...t,backgroundImageUrl:""}),v(null)},children:"Remove"})]}):e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"No image selected."})]}),e.jsxs("div",{className:"border rounded p-4 space-y-3 bg-gray-50",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{placeholder:"Search Unsplash",value:x,onChange:s=>j(s.target.value)}),e.jsx(u,{onClick:L,disabled:f,children:e.jsx(Z,{className:"h-4 w-4"})})]}),a&&e.jsx("p",{className:"text-sm text-red-600",children:a}),h.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-64 overflow-y-auto",children:h.map(s=>e.jsxs("button",{type:"button",onClick:()=>{v(s),r({...t,backgroundImageUrl:s.urls.regular})},className:`relative border rounded overflow-hidden ${i?.id===s.id?"ring-2 ring-wine-500":"hover:ring-2 hover:ring-wine-300"}`,children:[e.jsx("img",{src:s.urls.thumb,alt:s.alt_description||"img",className:"w-full h-20 object-cover"}),i?.id===s.id&&e.jsx("span",{className:"absolute inset-0 bg-wine-600/40 flex items-center justify-center text-white text-xs font-semibold",children:"Selected"})]},s.id))}),i&&e.jsxs("p",{className:"text-[11px] text-gray-600",children:["Photo by ",e.jsx("a",{className:"underline",target:"_blank",rel:"noreferrer",href:`${i.user.links.html}?utm_source=TriviaSpark&utm_medium=referral`,children:i.user.name})," on ",e.jsx("a",{className:"underline",target:"_blank",rel:"noreferrer",href:`${i.links.html}?utm_source=TriviaSpark&utm_medium=referral`,children:"Unsplash"})]})]})]})]})]})},he=({eventId:n})=>{const[,b]=_("/events/:id/manage/trivia"),[,w]=B(),g=$(),{toast:t}=D(),r=n||b?.id,[x,j]=m.useState(null),{data:h=[],isLoading:C}=P({queryKey:["/api/events",r,"questions"],enabled:!!r}),f=I({mutationFn:async a=>{const l=await fetch(`/api/questions/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});if(!l.ok)throw new Error("Failed to update question");return l.json()},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/events",r,"questions"]}),t({title:"Saved",description:"Question updated."}),j(null)},onError:a=>t({title:"Update failed",description:a.message,variant:"destructive"})}),y=I({mutationFn:async a=>{if(!(await fetch(`/api/questions/${a}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete")},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/events",r,"questions"]}),t({title:"Deleted",description:"Question removed."})},onError:a=>t({title:"Delete failed",description:a.message,variant:"destructive"})});return r?C?e.jsx("div",{className:"p-8 text-center",children:"Loading questions..."}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(u,{variant:"ghost",onClick:()=>w(`/events/${r}/manage`),className:"text-wine-700",children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Back to Event"]}),e.jsxs("h1",{className:"text-2xl font-bold text-wine-800 flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6"})," Trivia Questions"]})]}),e.jsxs(p,{variant:"outline",children:[h.length," Questions"]})]}),e.jsxs(F,{className:"trivia-card",children:[e.jsx(O,{children:e.jsx(R,{className:"wine-text",children:"All Questions"})}),e.jsx(M,{children:h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),"No questions yet."]}):e.jsx("div",{className:"space-y-4",children:h.sort((a,l)=>a.orderIndex-l.orderIndex).map((a,l)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-white hover:shadow-sm transition flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2 items-center",children:[e.jsxs(p,{variant:"secondary",children:["#",a.orderIndex||l+1]}),e.jsx(p,{variant:"outline",children:a.type.replace("_"," ")}),e.jsxs(p,{variant:"outline",children:[a.points," pts"]}),e.jsxs(p,{variant:"outline",children:[a.timeLimit,"s"]}),a.aiGenerated&&e.jsx(p,{variant:"outline",className:"bg-blue-50 text-blue-600",children:"AI"})]}),e.jsx("h3",{className:"font-medium text-gray-900 mb-2 line-clamp-2",children:a.question}),a.options?.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",children:a.options.map((i,v)=>e.jsxs("div",{className:`text-xs p-2 rounded ${i===a.correctAnswer?"bg-green-100 text-green-800 font-medium":"bg-gray-100 text-gray-700"}`,children:[String.fromCharCode(65+v),". ",i]},v))}),e.jsxs("p",{className:"text-xs text-green-600 font-medium mb-1",children:["Correct: ",a.correctAnswer]}),a.explanation&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:a.explanation})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>j(a),children:[e.jsx(G,{className:"h-4 w-4 mr-1"})," Edit"]}),e.jsxs(u,{size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700",onClick:()=>{confirm("Delete this question?")&&y.mutate(a.id)},children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},a.id))})})]}),x&&e.jsx("div",{className:"fixed inset-0 z-30 bg-white overflow-y-auto px-6 py-10",children:e.jsx(q,{question:x,saving:f.isPending,onClose:()=>j(null),onSave:a=>f.mutate(a)})})]})}):e.jsx("div",{className:"p-8 text-center",children:"Invalid event."})};export{he as default};
