import{c as U,a as P,b as R,r as v,j as e,q as L}from"./index-CopS3Psk.js";import{u as T}from"./useQuery-DkKqOiwU.js";import{u as w}from"./useMutation-DQatjKcT.js";import{C as d,a as c,b as o,c as m}from"./card-AfcxHV9F.js";import{B as u}from"./button-DQ4bLXMp.js";import{L as x,I as h}from"./label-BQUEL3FP.js";import{B as M}from"./badge-ssJfnrvI.js";import{S as f}from"./shield-D8Yyneph.js";import{U as N}from"./users-Bk5ZGpiD.js";import{K as D}from"./key-ByNDarRl.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],b=U("crown",K);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],C=U("user-plus",B);function G(){const{toast:n}=P(),y=R(),[A,p]=v.useState(!1),[a,i]=v.useState({username:"",email:"",fullName:"",password:"",roleName:"User"}),{data:r,isLoading:S,error:E}=T({queryKey:["/api/admin/users"],retry:!1}),j=w({mutationFn:async s=>{const t=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!t.ok){const l=await t.json();throw new Error(l.error||"Failed to create user")}return t.json()},onSuccess:()=>{n({title:"User Created",description:"New user has been successfully created."}),y.invalidateQueries({queryKey:["/api/admin/users"]}),p(!1),i({username:"",email:"",fullName:"",password:"",roleName:"User"})},onError:s=>{n({title:"Create User Failed",description:s.message,variant:"destructive"})}}),g=w({mutationFn:async({userId:s,roleName:t})=>{const l=await fetch(`/api/admin/users/${s}/change-role`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roleName:t}),credentials:"include"});if(!l.ok){const q=await l.json();throw new Error(q.error||"Failed to change user role")}return l.json()},onSuccess:()=>{n({title:"Role Updated",description:"User role has been successfully updated."}),y.invalidateQueries({queryKey:["/api/admin/users"]})},onError:s=>{n({title:"Role Update Failed",description:s.message,variant:"destructive"})}}),k=s=>{if(s.preventDefault(),!a.username||!a.email||!a.fullName||!a.password){n({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}j.mutate(a)},F=(s,t)=>{const l=t==="Admin"?"User":"Admin";g.mutate({userId:s,roleName:l})};return E?e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(f,{className:"mx-auto h-16 w-16 text-destructive mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You need admin privileges to access this page."})]})}):S?e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(f,{className:"text-champagne-400 h-8 w-8 animate-pulse"})}),e.jsx("p",{className:"text-primary",children:"Loading admin panel..."})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{className:"h-8 w-8 text-primary mr-3"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground","data-testid":"text-admin-title",children:"Admin Panel"}),e.jsx("p",{className:"text-muted-foreground","data-testid":"text-admin-subtitle",children:"Manage users and system settings"})]})]}),e.jsxs(u,{onClick:()=>p(!0),className:"trivia-button-primary","data-testid":"button-create-user",children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Create User"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(d,{className:"trivia-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(N,{className:"h-4 w-4 text-primary"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:r?.length||0})})]}),e.jsxs(d,{className:"trivia-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Admin Users"}),e.jsx(f,{className:"h-4 w-4 text-primary"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:r?.filter(s=>s.roleName==="Admin").length||0})})]}),e.jsxs(d,{className:"trivia-card",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Regular Users"}),e.jsx(N,{className:"h-4 w-4 text-primary"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:r?.filter(s=>s.roleName==="User").length||0})})]})]}),A&&e.jsxs(d,{className:"trivia-card mb-8","data-testid":"card-create-user",children:[e.jsx(c,{children:e.jsxs(o,{className:"flex items-center",children:[e.jsx(C,{className:"mr-2 h-5 w-5"}),"Create New User"]})}),e.jsx(m,{children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"username",children:"Username"}),e.jsx(h,{id:"username",value:a.username,onChange:s=>i({...a,username:s.target.value}),placeholder:"Enter username",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"Enter email",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"fullName",children:"Full Name"}),e.jsx(h,{id:"fullName",value:a.fullName,onChange:s=>i({...a,fullName:s.target.value}),placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"password",children:"Password"}),e.jsx(h,{id:"password",type:"password",value:a.password,onChange:s=>i({...a,password:s.target.value}),placeholder:"Enter password",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",title:"User Role",value:a.roleName,onChange:s=>i({...a,roleName:s.target.value}),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-ring",children:[e.jsx("option",{value:"User",children:"User"}),e.jsx("option",{value:"Admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(u,{type:"submit",disabled:j.isPending,className:"trivia-button-primary",children:j.isPending?"Creating...":"Create User"}),e.jsx(u,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"})]})]})})]}),e.jsxs(d,{className:"trivia-card","data-testid":"card-users-table",children:[e.jsx(c,{children:e.jsxs(o,{className:"flex items-center",children:[e.jsx(N,{className:"mr-2 h-5 w-5"}),"All Users (",r?.length||0,")"]})}),e.jsx(m,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-foreground",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-foreground",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-foreground",children:"Role"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-foreground",children:"Created"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-foreground",children:"Actions"})]})}),e.jsxs("tbody",{children:[r?.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:s.fullName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["@",s.username]})]})}),e.jsx("td",{className:"py-3 px-4 text-foreground",children:s.email}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(M,{variant:s.roleName==="Admin"?"destructive":"secondary",className:s.roleName==="Admin"?"bg-primary/10 text-primary":"",children:[s.roleName==="Admin"&&e.jsx(b,{className:"w-3 h-3 mr-1"}),s.roleName]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:L(s.createdAt)}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>F(s.id,s.roleName),disabled:g.isPending,className:"text-xs",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),s.roleName==="Admin"?"Demote to User":"Promote to Admin"]})})]},s.id)),(!r||r.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-8 text-center text-muted-foreground",children:"No users found."})})]})]})})})]})]})}export{G as default};
