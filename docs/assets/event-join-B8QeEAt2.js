import{c as A,r as l,d as ne,j as e,e as $,h as R,k as G,i as _,P as oe,w as ce,n as B,o as de,a as le}from"./index-DtqRKUro.js";import{u as me}from"./useQuery-C-X23R5U.js";import{u as q}from"./useMutation-CcvHL0XZ.js";import{C as k,a as S,b as E,c as I}from"./card-DQhu4WgR.js";import{B as L}from"./button-DcuKGgm9.js";import{L as g,I as T}from"./label-Dg-yljya.js";import{c as V,R as ue,I as xe}from"./index-DxezoWtC.js";import{u as pe}from"./index-CzxATLan.js";import{u as he,S as fe,a as je,b as ve,c as be,d as ye}from"./select-BhlKOcgM.js";import{C as Ne}from"./circle-BbeyXHR6.js";import{u as ge}from"./index.esm-B67yqqKr.js";import{a as we,o as Re,s as D,eM as Ce}from"./schemas-BgajsbNu.js";import{C as ke}from"./clock-D5zTVJuu.js";import{U as P}from"./users-1V5XLkoJ.js";import{T as Se}from"./trophy-D6-m2Fra.js";import{B as O}from"./brain-9qS9hA4V.js";import"./Combination-CwxOFbug.js";import"./index-BdQq_4o_.js";import"./chevron-up-Bv7hkZXE.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Ie=A("arrow-right",Ee);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Pe=A("hash",Te);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ae=A("user-check",_e);var F="Radio",[Ge,J]=$(F),[Fe,Me]=Ge(F),U=l.forwardRef((c,r)=>{const{__scopeRadio:a,name:s,checked:i=!1,required:n,disabled:m,value:p="on",onCheck:j,form:v,...b}=c,[o,h]=l.useState(null),u=G(r,N=>h(N)),f=l.useRef(!1),y=o?v||!!o.closest("form"):!0;return e.jsxs(Fe,{scope:a,checked:i,disabled:m,children:[e.jsx(R.button,{type:"button",role:"radio","aria-checked":i,"data-state":Y(i),"data-disabled":m?"":void 0,disabled:m,value:p,...b,ref:u,onClick:_(c.onClick,N=>{i||j?.(),y&&(f.current=N.isPropagationStopped(),f.current||N.stopPropagation())})}),y&&e.jsx(H,{control:o,bubbles:!f.current,name:s,value:p,checked:i,required:n,disabled:m,form:v,style:{transform:"translateX(-100%)"}})]})});U.displayName=F;var W="RadioIndicator",K=l.forwardRef((c,r)=>{const{__scopeRadio:a,forceMount:s,...i}=c,n=Me(W,a);return e.jsx(oe,{present:s||n.checked,children:e.jsx(R.span,{"data-state":Y(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:r})})});K.displayName=W;var qe="RadioBubbleInput",H=l.forwardRef(({__scopeRadio:c,control:r,checked:a,bubbles:s=!0,...i},n)=>{const m=l.useRef(null),p=G(m,n),j=he(a),v=ce(r);return l.useEffect(()=>{const b=m.current;if(!b)return;const o=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(o,"checked").set;if(j!==a&&u){const f=new Event("click",{bubbles:s});u.call(b,a),b.dispatchEvent(f)}},[j,a,s]),e.jsx(R.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:p,style:{...i.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});H.displayName=qe;function Y(c){return c?"checked":"unchecked"}var Le=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],C="RadioGroup",[De,lt]=$(C,[V,J]),z=V(),Q=J(),[Oe,$e]=De(C),X=l.forwardRef((c,r)=>{const{__scopeRadioGroup:a,name:s,defaultValue:i,value:n,required:m=!1,disabled:p=!1,orientation:j,dir:v,loop:b=!0,onValueChange:o,...h}=c,u=z(a),f=pe(v),[y,N]=ne({prop:n,defaultProp:i??null,onChange:o,caller:C});return e.jsx(Oe,{scope:a,name:s,required:m,disabled:p,value:y,onValueChange:N,children:e.jsx(ue,{asChild:!0,...u,orientation:j,dir:f,loop:b,children:e.jsx(R.div,{role:"radiogroup","aria-required":m,"aria-orientation":j,"data-disabled":p?"":void 0,dir:f,...h,ref:r})})})});X.displayName=C;var Z="RadioGroupItem",ee=l.forwardRef((c,r)=>{const{__scopeRadioGroup:a,disabled:s,...i}=c,n=$e(Z,a),m=n.disabled||s,p=z(a),j=Q(a),v=l.useRef(null),b=G(r,v),o=n.value===i.value,h=l.useRef(!1);return l.useEffect(()=>{const u=y=>{Le.includes(y.key)&&(h.current=!0)},f=()=>h.current=!1;return document.addEventListener("keydown",u),document.addEventListener("keyup",f),()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",f)}},[]),e.jsx(xe,{asChild:!0,...p,focusable:!m,active:o,children:e.jsx(U,{disabled:m,required:n.required,checked:o,...j,...i,name:n.name,ref:b,onCheck:()=>n.onValueChange(i.value),onKeyDown:_(u=>{u.key==="Enter"&&u.preventDefault()}),onFocus:_(i.onFocus,()=>{h.current&&v.current?.click()})})})});ee.displayName=Z;var Be="RadioGroupIndicator",te=l.forwardRef((c,r)=>{const{__scopeRadioGroup:a,...s}=c,i=Q(a);return e.jsx(K,{...i,...s,ref:r})});te.displayName=Be;var ae=X,se=ee,Ve=te;const re=l.forwardRef(({className:c,...r},a)=>e.jsx(ae,{className:B("grid gap-2",c),...r,ref:a}));re.displayName=ae.displayName;const w=l.forwardRef(({className:c,...r},a)=>e.jsx(se,{ref:a,className:B("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c),...r,children:e.jsx(Ve,{className:"flex items-center justify-center",children:e.jsx(Ne,{className:"h-2.5 w-2.5 fill-current text-current"})})}));w.displayName=se.displayName;const Je=Re({name:D().min(1,"Name is required").max(50,"Name too long"),teamAction:Ce(["none","join","create"]),teamIdentifier:D().max(50,"Team name/number too long").optional()});function mt(){const[,c]=de("/join/:qrCode"),r=c?.qrCode,{toast:a}=le(),[s,i]=l.useState(null),[n,m]=l.useState(null),{register:p,handleSubmit:j,watch:v,setValue:b,formState:{errors:o}}=ge({resolver:we(Je),defaultValues:{teamAction:"none",name:"",teamIdentifier:""}}),h=v("teamAction");l.useEffect(()=>{r&&(async()=>{try{const x=await fetch(`/api/events/join/${r}/check`,{credentials:"include"});if(x.ok){const d=await x.json();d.returning&&(m(d.participant),i(d))}}catch{}})()},[r]);const{data:u,isLoading:f}=me({queryKey:[`/api/events/${r}/teams-public`],enabled:!!r&&h==="join"&&!s}),y=q({mutationFn:async t=>{const x=await fetch(`/api/events/join/${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!x.ok){const d=await x.json();throw new Error(d.error||"Failed to join event")}return x.json()},onSuccess:t=>{i(t),m(t.participant),t.returning?a({title:"Welcome back!",description:`You're already joined as ${t.participant.name}`}):a({title:"Welcome to the event!",description:`You've successfully joined ${t.event.title}`})},onError:t=>{a({title:"Error",description:t.message,variant:"destructive"})}}),N=q({mutationFn:async t=>{const x=await fetch(`/api/participants/${n.id}/team`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamId:t}),credentials:"include"});if(!x.ok){const d=await x.json();throw new Error(d.error||"Failed to switch teams")}return x.json()},onSuccess:t=>{m(t),a({title:"Team updated!",description:"You've successfully switched teams"})},onError:t=>{a({title:"Error",description:t.message,variant:"destructive"})}}),ie=t=>{y.mutate(t)},M=t=>{N.mutate(t)};if(n&&s){const t=s.team,x=n.canSwitchTeam;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center p-4",children:e.jsxs(k,{className:"w-full max-w-md trivia-card","data-testid":"card-participant-status",children:[e.jsxs(S,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ae,{className:"h-8 w-8 text-white"})}),e.jsxs(E,{className:"text-2xl wine-text","data-testid":"text-welcome-back-title",children:["Welcome back, ",n.name,"!"]})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-wine-50 rounded-lg border border-wine-200",children:[e.jsx("h3",{className:"font-semibold text-wine-800 mb-2","data-testid":"text-event-title",children:s.event.title}),e.jsx("p",{className:"text-sm text-gray-600","data-testid":"text-event-description",children:s.event.description})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Team Status"}),t?e.jsx("div",{className:"p-3 bg-champagne-50 rounded-lg border border-champagne-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-champagne-800","data-testid":"text-current-team",children:t.name}),t.tableNumber&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Table ",t.tableNumber]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.participantCount,"/",t.maxMembers," members"]})]}),x&&e.jsx(L,{onClick:()=>M(null),variant:"outline",size:"sm","data-testid":"button-leave-team",children:"Leave Team"})]})}):e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"You're not on a team"}),x&&u&&u.length>0&&e.jsxs(fe,{onValueChange:M,"data-testid":"select-join-team",children:[e.jsx(je,{className:"w-full",children:e.jsx(ve,{placeholder:"Join a team"})}),e.jsx(be,{children:u.filter(d=>d.participantCount<d.maxMembers).map(d=>e.jsxs(ye,{value:d.id,children:[d.name," ",d.tableNumber?`(Table ${d.tableNumber})`:"","(",d.participantCount,"/",d.maxMembers,")"]},d.id))})]})]}),!x&&e.jsxs("div",{className:"flex items-center justify-center text-sm text-amber-600 bg-amber-50 p-3 rounded-lg",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Team switching is locked (event has started)"]})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-600",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),e.jsx("span",{"data-testid":"text-waiting-message",children:s.event.status==="active"?"Event in progress...":"Waiting for the host to start..."})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center","data-testid":"text-instructions",children:"Keep this page open. The trivia will continue shortly!"})]})]})]})})}return s&&!n?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center p-4",children:e.jsxs(k,{className:"w-full max-w-md trivia-card","data-testid":"card-joined-success",children:[e.jsxs(S,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Se,{className:"h-8 w-8 text-white"})}),e.jsxs(E,{className:"text-2xl wine-text","data-testid":"text-welcome-title",children:["Welcome, ",s.participant.name,"!"]})]}),e.jsxs(I,{className:"text-center space-y-4",children:[e.jsxs("div",{className:"p-4 bg-wine-50 rounded-lg border border-wine-200",children:[e.jsx("h3",{className:"font-semibold text-wine-800 mb-2","data-testid":"text-event-title",children:s.event.title}),e.jsx("p",{className:"text-sm text-gray-600","data-testid":"text-event-description",children:s.event.description})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-600",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),e.jsx("span",{"data-testid":"text-waiting-message",children:s.event.status==="active"?"Event in progress...":"Waiting for the host to start..."})]}),e.jsx("div",{className:"text-xs text-gray-500","data-testid":"text-instructions",children:"Keep this page open. The trivia will begin shortly!"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-lg flex items-center justify-center mr-4",children:e.jsx(O,{className:"text-champagne-400 h-8 w-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold wine-text","data-testid":"text-brand-title",children:"TriviaSpark"}),e.jsx("p",{className:"text-sm text-gray-500","data-testid":"text-brand-tagline",children:"A WebSpark Solution"})]})]}),e.jsx("p",{className:"text-gray-600","data-testid":"text-join-subtitle",children:"Join the trivia event"})]}),e.jsxs(k,{className:"trivia-card","data-testid":"card-join-form",children:[e.jsx(S,{children:e.jsxs(E,{className:"text-center","data-testid":"text-join-title",children:["Event Code: ",e.jsx("span",{className:"font-mono champagne-text",children:r})]})}),e.jsxs(I,{children:[e.jsxs("form",{onSubmit:j(ie),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"name","data-testid":"label-name",children:"Your Name *"}),e.jsx(T,{id:"name",...p("name"),placeholder:"Enter your name",className:o.name?"border-red-500":"","data-testid":"input-name"}),o.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-name",children:o.name.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{"data-testid":"label-team-options",children:"Team Options"}),e.jsxs(re,{value:h,onValueChange:t=>b("teamAction",t),className:"space-y-3","data-testid":"radio-team-options",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"none",id:"none"}),e.jsx(g,{htmlFor:"none",className:"font-normal",children:"Play individually (no team)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"join",id:"join"}),e.jsx(g,{htmlFor:"join",className:"font-normal",children:"Join existing team"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"create",id:"create"}),e.jsx(g,{htmlFor:"create",className:"font-normal",children:"Create new team"})]})]}),h==="join"&&e.jsxs("div",{className:"mt-3",children:[e.jsx(g,{htmlFor:"teamIdentifier","data-testid":"label-team-join",children:"Team Name or Table Number"}),e.jsx(T,{id:"teamIdentifier",...p("teamIdentifier"),placeholder:"Enter team name or table number",className:o.teamIdentifier?"border-red-500":"","data-testid":"input-team-join"}),o.teamIdentifier&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-team-join",children:o.teamIdentifier.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Example: "Wine Lovers" or "3" for Table 3'})]}),h==="create"&&e.jsxs("div",{className:"mt-3",children:[e.jsx(g,{htmlFor:"teamIdentifier","data-testid":"label-team-create",children:"New Team Name or Table Number"}),e.jsx(T,{id:"teamIdentifier",...p("teamIdentifier"),placeholder:"Enter team name or table number",className:o.teamIdentifier?"border-red-500":"","data-testid":"input-team-create"}),o.teamIdentifier&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-team-create",children:o.teamIdentifier.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Example: "Team Awesome" or "5" for Table 5'})]})]}),e.jsx(L,{type:"submit",disabled:y.isPending,className:"w-full trivia-button-primary","data-testid":"button-join-event",children:y.isPending?"Joining...":e.jsxs(e.Fragment,{children:["Join Event",e.jsx(Ie,{className:"ml-2 h-4 w-4"})]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),e.jsx("span",{"data-testid":"text-ai-powered",children:"AI-Powered Trivia Experience"})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(P,{className:"mr-1 h-3 w-3"}),e.jsx("span",{children:"Teams up to 6 members"})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Pe,{className:"mr-1 h-3 w-3"}),e.jsx("span",{children:"Switch teams before game starts"})]})]})]})]}),e.jsx("div",{className:"text-center mt-6 text-xs text-gray-500","data-testid":"text-footer",children:"Powered by TriviaSpark • Created by Mark Hazleton"})]})})}export{mt as default};
