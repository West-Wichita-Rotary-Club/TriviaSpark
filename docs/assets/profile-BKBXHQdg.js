import{c as H,a as K,u as Q,r as U,j as e,q as V,L as E,X as k}from"./index-gS79Ye6e.js";import{u as X}from"./useQuery-CBPvKjsV.js";import{u as q}from"./useMutation-BM0wqqWN.js";import{u as L}from"./index.esm-9dgKRIB0.js";import{C as N,a as g,b as v,c as y}from"./card-bGlXR2a8.js";import{B as r}from"./button-DFQGhScy.js";import{L as t,I as l}from"./label-O0gfusfS.js";import{A as G,a as W,U as Z}from"./avatar-GI9RcTmz.js";import{S as b}from"./separator-CecmM5Kb.js";import{B as $}from"./brain-9WYu4vze.js";import{C as ee}from"./calendar-D3fOQ1iA.js";import{S as m}from"./shield-S4XLm-B7.js";import{S as A}from"./settings-kjHBjo8d.js";import{S as se}from"./square-pen-Cj-2cfyU.js";import{S as ae}from"./save-0z_k7bTm.js";import{M as te}from"./mail-BGlQ4GDx.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ie=H("lock",re);function ye(){const{toast:c}=K(),[,M]=Q(),[P,o]=U.useState(!1),[S,x]=U.useState(!1),{data:s,isLoading:u,error:I}=X({queryKey:["/api/auth/me"],retry:!1});if(I||!u&&!s)return M("/"),null;if(u)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx($,{className:"text-champagne-400 h-8 w-8 animate-pulse"})}),e.jsx("p",{className:"text-wine-700",children:"Loading..."})]})});const{register:h,handleSubmit:T,reset:C,formState:{errors:d}}=L(),{register:p,handleSubmit:z,reset:F,watch:B,formState:{errors:n}}=L(),D=B("newPassword"),w=q({mutationFn:async a=>{const i=await fetch("/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});if(!i.ok){const f=await i.json();throw new Error(f.error||"Update failed")}return i.json()},onSuccess:()=>{c({title:"Profile Updated",description:"Your profile has been successfully updated."}),o(!1)},onError:a=>{c({title:"Update Failed",description:a.message,variant:"destructive"})}}),j=q({mutationFn:async a=>{const i=await fetch("/api/v2/auth/change-password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:a.currentPassword,newPassword:a.newPassword}),credentials:"include"});if(!i.ok){const f=await i.json();throw new Error(f.error||"Password change failed")}return i.json()},onSuccess:()=>{c({title:"Password Changed",description:"Your password has been successfully updated."}),x(!1),F()},onError:a=>{c({title:"Password Change Failed",description:a.message,variant:"destructive"})}}),J=a=>{w.mutate(a)},O=a=>{j.mutate(a)},R=()=>{s?.user&&C({fullName:s.user.fullName,email:s.user.email,username:s.user.username}),o(!0)},Y=()=>{o(!1),C()},_=()=>{x(!1),F()};return u?e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900","data-testid":"text-profile-title",children:"User Profile"}),e.jsx("p",{className:"text-gray-600","data-testid":"text-profile-subtitle",children:"Manage your account information and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs(N,{className:"trivia-card","data-testid":"card-profile-overview",children:[e.jsxs(g,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(G,{className:"w-24 h-24","data-testid":"avatar-profile",children:e.jsx(W,{className:"wine-gradient text-white text-2xl font-bold",children:s?.user?.fullName?.split(" ").map(a=>a[0]).join("")||"U"})})}),e.jsx(v,{className:"text-xl","data-testid":"text-user-name",children:s?.user?.fullName||"User"}),e.jsxs("p",{className:"text-gray-600","data-testid":"text-user-username",children:["@",s?.user?.username]})]}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{"data-testid":"text-member-since",children:["Member since ",s?.user?.createdAt?V(s.user.createdAt):"Unknown"]})]}),s?.user?.roleName&&e.jsxs("div",{className:"flex items-center text-sm text-wine-600",children:[e.jsx(m,{className:"mr-2 h-4 w-4"}),e.jsx("span",{"data-testid":"text-user-role",className:"font-medium",children:s.user.roleName})]}),s?.user?.roleName==="Admin"&&e.jsx("div",{className:"pt-2",children:e.jsx(E,{href:"/admin","data-testid":"link-admin-overview",children:e.jsxs(r,{className:"w-full trivia-button-primary text-sm",size:"sm",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Admin Panel"]})})})]})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(N,{className:"trivia-card","data-testid":"card-profile-info",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(v,{className:"flex items-center","data-testid":"text-profile-info-title",children:[e.jsx(Z,{className:"mr-2 h-5 w-5"}),"Profile Information"]}),!P&&e.jsxs(r,{onClick:R,variant:"outline",size:"sm","data-testid":"button-edit-profile",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Edit"]})]})}),e.jsx(y,{children:P?e.jsxs("form",{onSubmit:T(J),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"fullName","data-testid":"label-full-name",children:"Full Name"}),e.jsx(l,{id:"fullName",...h("fullName",{required:"Full name is required"}),className:"mt-1","data-testid":"input-full-name"}),d.fullName&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-full-name",children:d.fullName.message})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"email","data-testid":"label-email",children:"Email Address"}),e.jsx(l,{id:"email",type:"email",...h("email",{required:"Email is required",pattern:{value:/\S+@\S+\.\S+/,message:"Enter a valid email address"}}),className:"mt-1","data-testid":"input-email"}),d.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-email",children:d.email.message})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"username","data-testid":"label-username",children:"Username"}),e.jsx(l,{id:"username",...h("username",{required:"Username is required"}),className:"mt-1","data-testid":"input-username"}),d.username&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-username",children:d.username.message})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(r,{type:"submit",disabled:w.isPending,className:"trivia-button-primary","data-testid":"button-save-profile",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Save Changes"]})}),e.jsxs(r,{type:"button",onClick:Y,variant:"outline","data-testid":"button-cancel-edit",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-gray-600",children:"Full Name"}),e.jsx("p",{className:"font-medium mt-1","data-testid":"text-display-full-name",children:s?.user?.fullName||"Not set"})]}),e.jsx(b,{}),e.jsxs("div",{children:[e.jsx(t,{className:"text-gray-600",children:"Email Address"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(te,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("p",{className:"font-medium","data-testid":"text-display-email",children:s?.user?.email||"Not set"})]})]}),e.jsx(b,{}),e.jsxs("div",{children:[e.jsx(t,{className:"text-gray-600",children:"Username"}),e.jsxs("p",{className:"font-medium mt-1","data-testid":"text-display-username",children:["@",s?.user?.username||"Not set"]})]}),s?.user?.roleName&&e.jsxs(e.Fragment,{children:[e.jsx(b,{}),e.jsxs("div",{children:[e.jsx(t,{className:"text-gray-600",children:"Role"}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{className:"mr-2 h-4 w-4 text-wine-500"}),e.jsx("p",{className:"font-medium text-wine-700","data-testid":"text-display-role",children:s.user.roleName})]}),s.user.roleName==="Admin"&&e.jsx(E,{href:"/admin","data-testid":"link-admin-page",children:e.jsxs(r,{variant:"outline",size:"sm",className:"ml-2 text-wine-600 border-wine-200 hover:bg-wine-50",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Admin Panel"]})})]})]})]})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(N,{className:"trivia-card","data-testid":"card-password-change",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(v,{className:"flex items-center","data-testid":"text-password-title",children:[e.jsx(ie,{className:"mr-2 h-5 w-5"}),"Password & Security"]}),!S&&e.jsxs(r,{onClick:()=>x(!0),variant:"outline",size:"sm","data-testid":"button-change-password",children:[e.jsx(m,{className:"mr-2 h-4 w-4"}),"Change Password"]})]})}),e.jsx(y,{children:S?e.jsxs("form",{onSubmit:z(O),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"currentPassword","data-testid":"label-current-password",children:"Current Password"}),e.jsx(l,{id:"currentPassword",type:"password",...p("currentPassword",{required:"Current password is required"}),className:"mt-1","data-testid":"input-current-password",autoComplete:"current-password"}),n.currentPassword&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-current-password",children:n.currentPassword.message})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"newPassword","data-testid":"label-new-password",children:"New Password"}),e.jsx(l,{id:"newPassword",type:"password",...p("newPassword",{required:"New password is required",minLength:{value:6,message:"Password must be at least 6 characters long"}}),className:"mt-1","data-testid":"input-new-password",autoComplete:"new-password"}),n.newPassword&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-new-password",children:n.newPassword.message})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"confirmPassword","data-testid":"label-confirm-new-password",children:"Confirm New Password"}),e.jsx(l,{id:"confirmPassword",type:"password",...p("confirmPassword",{required:"Please confirm your new password",validate:a=>a===D||"Passwords do not match"}),className:"mt-1","data-testid":"input-confirm-new-password",autoComplete:"new-password"}),n.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-confirm-new-password",children:n.confirmPassword.message})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(r,{type:"submit",disabled:j.isPending,className:"trivia-button-primary","data-testid":"button-save-password",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"mr-2 h-4 w-4"}),"Update Password"]})}),e.jsxs(r,{type:"button",onClick:_,variant:"outline","data-testid":"button-cancel-password",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{className:"mr-3 h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Password"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Last updated: Never shown for security"})]})]}),e.jsx("div",{className:"text-green-600 text-sm font-medium",children:"Secure"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[e.jsx("p",{children:"• Use a strong password with at least 6 characters"}),e.jsx("p",{children:"• Consider using a combination of letters, numbers, and symbols"}),e.jsx("p",{children:"• Don't reuse passwords from other accounts"})]})]})})]})})]})]})}export{ye as default};
