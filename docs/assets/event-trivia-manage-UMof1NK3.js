import{c as Y,a as $,r as j,j as e,d as te,u as ae,b as ne,R as re}from"./index-DGcor4_P.js";import{u as z}from"./useQuery-DnLNc_Lt.js";import{u as V}from"./useMutation-DehuvvjI.js";import{B as w}from"./button-D4tw2gJm.js";import{C as G,a as M,b as O,c as B}from"./card-BDdLGUcT.js";import{B as v}from"./badge-CW-ZrBXS.js";import{L as o,I as b,u as ie}from"./label-Ddtw_64f.js";import{T as K}from"./textarea-CfChE7ES.js";import{S as Q,a as U,b as D,c as _,d as u}from"./select-B2uLPe3y.js";import{e as le,T as oe,D as ce,a as de,b as me,c as ue,d as he}from"./dialog-l0IWThSa.js";import{a as xe,o as ge,n as pe,s as q}from"./schemas-Nnvg4d7k.js";import{S as J,a as je}from"./square-pen-C3Kskdcf.js";import{A as ve}from"./arrow-left-CfLYsWYQ.js";import{B as P}from"./brain-Kwy1ZqE1.js";import{W}from"./wand-sparkles-8BVRHm4j.js";import{S as fe}from"./sparkles-CkKgiFyv.js";import"./index-BdQq_4o_.js";import"./index-C8yJiuLv.js";import"./Combination-_yJ_PGMk.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ne=Y("image",ye);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],we=Y("search",be);function Ie({question:i,onSave:N,onCancel:I,isLoading:x}){const{toast:g}=$(),[p,m]=j.useState(!1),[n,l]=j.useState({question:i.question,correctAnswer:i.correctAnswer,options:i.options||[],points:i.points,timeLimit:i.timeLimit,difficulty:i.difficulty,category:i.category,explanation:i.explanation||"",orderIndex:i.orderIndex,backgroundImageUrl:i.backgroundImageUrl||""}),[h,T]=j.useState(""),[S,f]=j.useState([]),[a,c]=j.useState(!1),[k,E]=j.useState(null),[t,y]=j.useState(null),{data:d,refetch:A}=z({queryKey:["/api/questions",i.id,"eventimage"],queryFn:async()=>{const s=await fetch(`/api/questions/${i.id}/eventimage`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch event image");return s.json()}}),[C,F]=j.useState({unsplashImageId:"",sizeVariant:"regular",usageContext:"question_background",searchContext:""});j.useEffect(()=>{if(d?.eventImage){const s=d.eventImage;F({unsplashImageId:s.unsplashImageId||"",sizeVariant:s.sizeVariant||"regular",usageContext:s.usageContext||"question_background",searchContext:s.searchContext||""})}},[d]);const L=V({mutationFn:async()=>{const s=await fetch(`/api/questions/${i.id}/eventimage`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(C),credentials:"include"});if(!s.ok){const r=await s.json();throw new Error(r.error||"Failed to save event image")}return s.json()},onSuccess:()=>{A(),g({title:"Event Image Saved",description:"Event image record has been saved successfully."})},onError:s=>{g({title:"Save Failed",description:s.message,variant:"destructive"})}}),R=async()=>{if(h.trim()){c(!0),E(null);try{const s=await fetch(`/api/unsplash/search?query=${encodeURIComponent(h)}&perPage=12`);if(!s.ok)throw new Error(`Search failed: ${s.statusText}`);const r=await s.json();f(r.results||[])}catch(s){E(s.message||"Failed to search images")}finally{c(!1)}}},X=s=>{y(s),l(r=>({...r,backgroundImageUrl:s.urls.regular})),F({unsplashImageId:s.id,sizeVariant:"regular",usageContext:"question_background",searchContext:h||""})},Z=async()=>{if(t?.links?.download_location)try{m(!0),await fetch("/api/unsplash/track-download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({downloadUrl:t.links.download_location})})}catch{}finally{m(!1)}},ee=async()=>{console.log("handleSave called, selectedImage:",t);const s={...i,question:n.question,correctAnswer:n.correctAnswer,options:n.options,points:n.points,timeLimit:n.timeLimit,difficulty:n.difficulty,category:n.category,explanation:n.explanation,orderIndex:n.orderIndex,backgroundImageUrl:n.backgroundImageUrl||null};if(console.log("Calling onSave with question and selectedImage:",{question:s,selectedImage:t}),N(s,t||void 0),C.unsplashImageId){console.log("Saving EventImage record with form data:",C);try{await L.mutateAsync()}catch(r){console.error("Failed to save EventImage record:",r)}}Z()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Question"}),e.jsx(K,{value:n.question,onChange:s=>l({...n,question:s.target.value}),className:"mt-1"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:n.options.map((s,r)=>e.jsxs("div",{children:[e.jsxs(o,{children:["Option ",String.fromCharCode(65+r)]}),e.jsx(b,{value:s,onChange:se=>{const H=[...n.options];H[r]=se.target.value,l({...n,options:H})},className:"mt-1"})]},r))}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Correct Answer"}),e.jsxs(Q,{value:n.correctAnswer,onValueChange:s=>l({...n,correctAnswer:s}),children:[e.jsx(U,{className:"mt-1",children:e.jsx(D,{})}),e.jsx(_,{children:n.options.map((s,r)=>e.jsxs(u,{value:s,children:[String.fromCharCode(65+r),": ",s]},r))})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Points"}),e.jsx(b,{type:"number",min:10,max:1e3,value:n.points,onChange:s=>l({...n,points:parseInt(s.target.value)||100}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Time Limit (seconds)"}),e.jsx(b,{type:"number",min:10,max:180,value:n.timeLimit,onChange:s=>l({...n,timeLimit:parseInt(s.target.value)||30}),className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Difficulty"}),e.jsxs(Q,{value:n.difficulty,onValueChange:s=>l({...n,difficulty:s}),children:[e.jsx(U,{className:"mt-1",children:e.jsx(D,{})}),e.jsxs(_,{children:[e.jsx(u,{value:"easy",children:"Easy"}),e.jsx(u,{value:"medium",children:"Medium"}),e.jsx(u,{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Category"}),e.jsx(b,{value:n.category,onChange:s=>l({...n,category:s.target.value}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Order"}),e.jsx(b,{type:"number",min:1,value:n.orderIndex,onChange:s=>l({...n,orderIndex:parseInt(s.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Explanation (Optional)"}),e.jsx(K,{value:n.explanation,onChange:s=>l({...n,explanation:s.target.value}),className:"mt-1",placeholder:"Explain why this is the correct answer..."})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Background Image"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(b,{placeholder:"Search for background image...",value:h,onChange:s=>T(s.target.value),onKeyPress:s=>s.key==="Enter"&&R(),"data-testid":"input-unsplash-search"}),e.jsxs(w,{type:"button",onClick:R,disabled:a,"data-testid":"button-unsplash-search",children:[e.jsx(we,{className:"h-4 w-4"}),a?"Searching...":"Search"]})]}),k&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:k}),S.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2 max-h-48 overflow-y-auto mt-3","data-testid":"grid-unsplash-results",children:S.map((s,r)=>e.jsxs("button",{type:"button",onClick:()=>X(s),className:`group relative border rounded-md overflow-hidden focus:outline-none ${t?.id===s.id?"ring-2 ring-wine-500":"hover:ring-2 hover:ring-wine-300"}`,"data-testid":`unsplash-result-${r}`,children:[e.jsx("img",{src:s.urls.thumb,alt:s.alt_description||s.description||"img",className:"w-full h-16 object-cover"}),t?.id===s.id&&e.jsx("span",{className:"absolute inset-0 bg-wine-600/40 flex items-center justify-center text-white text-xs font-medium",children:"Selected"})]},s.id))}),t&&e.jsxs("p",{className:"text-[11px] text-gray-600 mt-2","data-testid":"text-unsplash-attribution",children:["Photo by ",e.jsx("a",{className:"underline",target:"_blank",rel:"noreferrer",href:`${t.user.links.html}?utm_source=TriviaSpark&utm_medium=referral`,children:t.user.name})," on ",e.jsx("a",{className:"underline",target:"_blank",rel:"noreferrer",href:`${t.links.html}?utm_source=TriviaSpark&utm_medium=referral`,children:"Unsplash"})]})]}),e.jsxs(G,{className:"mt-4 border-2 border-wine-300",children:[e.jsxs(M,{className:"pb-3 bg-wine-50",children:[e.jsx(O,{className:"text-sm font-medium text-wine-800",children:"ðŸ–¼ï¸ Event Image Management"}),e.jsx("p",{className:"text-xs text-wine-600",children:"Configure and manage image metadata for this question"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"unsplashImageId",className:"text-xs",children:"Unsplash Image ID"}),e.jsx(b,{id:"unsplashImageId",value:C.unsplashImageId,onChange:s=>F(r=>({...r,unsplashImageId:s.target.value})),placeholder:"Enter Unsplash image ID",className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"sizeVariant",className:"text-xs",children:"Size Variant"}),e.jsxs(Q,{value:C.sizeVariant,onValueChange:s=>F(r=>({...r,sizeVariant:s})),children:[e.jsx(U,{className:"text-xs",children:e.jsx(D,{placeholder:"Select size"})}),e.jsxs(_,{children:[e.jsx(u,{value:"thumb",children:"Thumb"}),e.jsx(u,{value:"small",children:"Small"}),e.jsx(u,{value:"regular",children:"Regular"}),e.jsx(u,{value:"full",children:"Full"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"usageContext",className:"text-xs",children:"Usage Context"}),e.jsxs(Q,{value:C.usageContext,onValueChange:s=>F(r=>({...r,usageContext:s})),children:[e.jsx(U,{className:"text-xs",children:e.jsx(D,{placeholder:"Select usage"})}),e.jsxs(_,{children:[e.jsx(u,{value:"question_background",children:"Question Background"}),e.jsx(u,{value:"event_banner",children:"Event Banner"}),e.jsx(u,{value:"category_icon",children:"Category Icon"}),e.jsx(u,{value:"promotional_material",children:"Promotional Material"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"searchContext",className:"text-xs",children:"Search Context"}),e.jsx(b,{id:"searchContext",value:C.searchContext,onChange:s=>F(r=>({...r,searchContext:s.target.value})),placeholder:"Search terms used",className:"text-xs"})]})]}),d?.eventImage&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(o,{className:"text-xs font-medium text-muted-foreground",children:"Current Image Info"}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["Created: ",new Date(d.eventImage.createdAt).toLocaleString()]}),e.jsxs("div",{children:["Downloaded: ",d.eventImage.downloadTracked?"Yes":"No"]}),d.eventImage.attributionText&&e.jsxs("div",{className:"col-span-2",children:["Attribution: ",e.jsx("a",{href:d.eventImage.attributionUrl,target:"_blank",rel:"noopener noreferrer",className:"text-wine-600 hover:underline",children:d.eventImage.attributionText})]}),d.eventImage.imageUrl&&e.jsx("div",{className:"col-span-2",children:e.jsx("img",{src:d.eventImage.thumbnailUrl||d.eventImage.imageUrl,alt:"Current image",className:"w-16 h-16 object-cover rounded border"})})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:()=>{t&&F({unsplashImageId:t.id,sizeVariant:"regular",usageContext:"question_background",searchContext:h||""})},disabled:!t,className:"text-xs",children:"Populate from Selected Image"}),e.jsx(w,{type:"button",size:"sm",onClick:()=>L.mutate(),disabled:L.isPending||!C.unsplashImageId,className:"text-xs",children:L.isPending?"Saving...":"Save Image Record"})]})]})]}),e.jsxs(le,{className:"pt-2",children:[e.jsx(w,{onClick:ee,disabled:x||p,className:"flex-1","data-testid":"button-save-question",children:x?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4 animate-pulse"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Save Changes"]})}),e.jsx(w,{onClick:I,variant:"outline",disabled:x,"data-testid":"button-cancel-edit",children:"Cancel"})]})]})}const Ce=({questionId:i,backgroundImageUrl:N})=>{const{data:I}=z({queryKey:["/api/questions",i,"eventimage"],queryFn:async()=>{const g=await fetch(`/api/questions/${i}/eventimage`,{credentials:"include"});if(!g.ok)throw new Error("Failed to fetch event image");return(await g.json()).eventImage},staleTime:3e5,enabled:!!i}),x=I?.thumbnailUrl||N;return x?e.jsx("div",{className:"w-16 h-12 rounded border overflow-hidden bg-gray-100 flex-shrink-0",children:e.jsx("img",{src:x,alt:"Question thumbnail",className:"w-full h-full object-cover",onError:g=>{const p=g.target;p.style.display="none";const m=p.parentElement;m&&(m.innerHTML='<div class="w-full h-full flex items-center justify-center text-gray-400"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m4 16 4.586-4.586a2 2 0 0 1 2.828 0L16 16m-2-2 1.586-1.586a2 2 0 0 1 2.828 0L20 14m-6-6h.01M6 20h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z" /></svg></div>')}})}):e.jsx("div",{className:"w-16 h-12 bg-gray-100 rounded border flex items-center justify-center text-gray-400",children:e.jsx(Ne,{className:"h-4 w-4"})})},Se=ge({eventId:q().min(1,"Event ID is required"),topic:q().min(1,"Topic is required"),type:q().optional(),count:pe().min(1).max(20)}),ke=({eventId:i,onQuestionsGenerated:N})=>{const{toast:I}=$(),[x,g]=j.useState([]),[p,m]=j.useState(!1),n=ie({resolver:xe(Se),defaultValues:{eventId:i,topic:"",type:"medium",count:3}}),{register:l,handleSubmit:h,setValue:T,watch:S,formState:{errors:f,isSubmitting:a}}=n,c=S(),k=V({mutationFn:async t=>{const y=await fetch("/api/events/generate-questions",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({eventId:t.eventId,topic:t.topic,type:t.type,count:t.count})});if(!y.ok){const d=await y.json();throw new Error(d.error||"Failed to generate questions")}return y.json()},onSuccess:t=>{g(t.questions||[]),m(!0),I({title:"Questions Generated!",description:`Successfully generated ${t.questions?.length||0} questions.`}),N(t.questions||[])},onError:t=>{I({title:"Generation Failed",description:t.message,variant:"destructive"})}}),E=t=>{k.mutate(t)};return e.jsxs(G,{className:"mb-6",children:[e.jsx(M,{children:e.jsxs(O,{className:"flex items-center gap-2 text-wine-800",children:[e.jsx(W,{className:"h-5 w-5"}),"AI Question Generator",e.jsxs(v,{variant:"secondary",className:"bg-purple-100 text-purple-700",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"Powered by GPT-4o"]})]})}),e.jsxs(B,{children:[e.jsxs("form",{onSubmit:h(E),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(o,{htmlFor:"topic",children:"Topic"}),e.jsx(b,{id:"topic",placeholder:"e.g., Oregon Wine, Pacific Northwest, History",...l("topic"),className:f.topic?"border-red-500":""}),f.topic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.topic.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"type",children:"Difficulty"}),e.jsxs(Q,{value:c.type,onValueChange:t=>T("type",t),children:[e.jsx(U,{className:f.type?"border-red-500":"",children:e.jsx(D,{})}),e.jsxs(_,{children:[e.jsx(u,{value:"easy",children:"Easy"}),e.jsx(u,{value:"medium",children:"Medium"}),e.jsx(u,{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"count",children:"Number of Questions"}),e.jsxs(Q,{value:c.count.toString(),onValueChange:t=>T("count",parseInt(t)),children:[e.jsx(U,{className:f.count?"border-red-500":"",children:e.jsx(D,{})}),e.jsx(_,{children:Array.from({length:20},(t,y)=>y+1).map(t=>e.jsx(u,{value:t.toString(),children:t},t))})]}),f.count&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.count.message})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{type:"submit",disabled:a,className:"bg-wine-600 hover:bg-wine-700",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Generate Questions"]})}),p&&x.length>0&&e.jsxs(v,{variant:"outline",className:"bg-green-50 text-green-700",children:["âœ“ ",x.length," questions generated"]})]})]}),p&&x.length>0&&e.jsx("div",{className:"mt-6 space-y-4",children:e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-wine-800 mb-3 flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Generated Questions Preview"]}),e.jsx("div",{className:"space-y-3",children:x.map((t,y)=>e.jsxs("div",{className:"border rounded-lg p-3 bg-green-50",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2 items-center",children:[e.jsxs(v,{variant:"secondary",children:["#",y+1]}),e.jsx(v,{variant:"outline",children:t.type?.replace("_"," ")}),e.jsx(v,{variant:"outline",children:t.difficulty}),e.jsx(v,{variant:"outline",className:"bg-purple-50 text-purple-600",children:"AI Generated"})]}),e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:t.question}),t.options&&t.options.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",children:t.options.map((d,A)=>e.jsxs("div",{className:`text-xs p-2 rounded ${d===t.correctAnswer?"bg-green-100 text-green-800 font-medium":"bg-gray-100 text-gray-700"}`,children:[String.fromCharCode(65+A),". ",d]},A))}),e.jsxs("p",{className:"text-xs text-green-600 font-medium mb-1",children:["Correct: ",t.correctAnswer]}),t.explanation&&e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{children:"Explanation:"})," ",t.explanation]})]},y))})]})})]})]})},He=({eventId:i,questionId:N})=>{const[,I]=te("/events/:id/manage/trivia"),[,x]=ae(),g=ne(),{toast:p}=$(),m=i||I?.id,[n,l]=j.useState(null),{data:h=[],isLoading:T}=z({queryKey:["/api/events",m,"questions"],enabled:!!m}),S=V({mutationFn:async a=>{const c=await fetch(`/api/questions/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});if(!c.ok)throw new Error("Failed to update question");return c.json()},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/events",m,"questions"]}),p({title:"Saved",description:"Question updated."}),l(null)},onError:a=>p({title:"Update failed",description:a.message,variant:"destructive"})}),f=V({mutationFn:async a=>{if(!(await fetch(`/api/questions/${a}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete")},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/events",m,"questions"]}),p({title:"Deleted",description:"Question removed."})},onError:a=>p({title:"Delete failed",description:a.message,variant:"destructive"})});return re.useEffect(()=>{if(N&&h.length>0&&!n){const a=h.find(c=>c.id===N);a&&(console.log("Auto-opening question for editing:",a),l(a))}},[N,h,n]),m?T?e.jsx("div",{className:"p-8 text-center",children:"Loading questions..."}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(w,{variant:"ghost",onClick:()=>x(`/events/${m}/manage`),className:"text-wine-700",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Back to Event"]}),e.jsxs("h1",{className:"text-2xl font-bold text-wine-800 flex items-center gap-2",children:[e.jsx(P,{className:"h-6 w-6"})," Trivia Questions"]})]}),e.jsxs(v,{variant:"outline",children:[h.length," Questions"]})]}),e.jsx(ke,{eventId:m,onQuestionsGenerated:a=>{g.invalidateQueries({queryKey:["/api/events",m,"questions"]})}}),e.jsxs(G,{className:"trivia-card",children:[e.jsx(M,{children:e.jsx(O,{className:"wine-text",children:"All Questions"})}),e.jsx(B,{children:h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No questions yet"}),e.jsx("p",{className:"text-sm",children:"Use the AI Question Generator above to get started, or manually add questions."})]}):e.jsx("div",{className:"space-y-4",children:h.sort((a,c)=>a.orderIndex-c.orderIndex).map((a,c)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-white hover:shadow-sm transition flex items-start gap-4",children:[e.jsx(Ce,{questionId:a.id,backgroundImageUrl:a.backgroundImageUrl}),e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2 items-center",children:[e.jsxs(v,{variant:"secondary",children:["#",a.orderIndex||c+1]}),e.jsx(v,{variant:"outline",children:a.type.replace("_"," ")}),e.jsxs(v,{variant:"outline",children:[a.points," pts"]}),e.jsxs(v,{variant:"outline",children:[a.timeLimit,"s"]}),a.aiGenerated&&e.jsx(v,{variant:"outline",className:"bg-blue-50 text-blue-600",children:"AI"})]}),e.jsx("h3",{className:"font-medium text-gray-900 mb-2 line-clamp-2",children:a.question}),a.options?.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",children:a.options.map((k,E)=>e.jsxs("div",{className:`text-xs p-2 rounded ${k===a.correctAnswer?"bg-green-100 text-green-800 font-medium":"bg-gray-100 text-gray-700"}`,children:[String.fromCharCode(65+E),". ",k]},E))}),e.jsxs("p",{className:"text-xs text-green-600 font-medium mb-1",children:["Correct: ",a.correctAnswer]}),a.explanation&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:a.explanation})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>l(a),children:[e.jsx(je,{className:"h-4 w-4 mr-1"})," Edit"]}),e.jsxs(w,{size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700",onClick:()=>{confirm("Delete this question?")&&f.mutate(a.id)},children:[e.jsx(oe,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},a.id))})})]}),n&&e.jsx(ce,{open:!!n,onOpenChange:a=>{a||l(null)},children:e.jsxs(de,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(ue,{children:"Edit Question with Image Management"}),e.jsx(he,{children:"Modify question content, scoring, ordering, background image, and EventImage record."})]}),e.jsx(Ie,{question:n,onSave:(a,c)=>{console.log("Trivia page received save:",{updatedQuestion:a,selectedImage:c}),S.mutate(a)},onCancel:()=>l(null),isLoading:S.isPending})]})})]})}):e.jsx("div",{className:"p-8 text-center",children:"Invalid event."})};export{He as default};
